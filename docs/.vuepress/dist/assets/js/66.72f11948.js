(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{568:function(t,e,o){"use strict";o.r(e);var n=o(0),a=Object(n.a)({},(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("h1",{attrs:{id:"tbtc-js-setup"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#tbtc-js-setup"}},[t._v("#")]),t._v(" tBTC.js Setup")]),t._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",[t._v("The source code related to this section can be found in "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Keep-tBTC.js"),o("OutboundLink")],1)])]),t._v(" "),o("p",[o("code",[t._v("tbtc.js")]),t._v(" provides JS bindings to the tBTC system. The "),o("a",{attrs:{href:"https://tbtc.network/",target:"_blank",rel:"noopener noreferrer"}},[t._v("tBTC system"),o("OutboundLink")],1),t._v(" is a bonded, multi-federated peg made up of many deposits backed by single-use BTC wallets to enable their value’s corresponding usage on the Ethereum chain, primarily through the minting of a TBTC ERC20 token whose supply is guaranteed to be backed by at least 1 BTC per TBTC in circulation.")]),t._v(" "),o("h2",{attrs:{id:"depending-or-installing"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#depending-or-installing"}},[t._v("#")]),t._v(" Depending or Installing")]),t._v(" "),o("p",[o("code",[t._v("tbtc.js")]),t._v(" is still prerelease software, and is aimed at the current testnet deployment of the tBTC system on Ropsten. This package and repo are in flux and will increase in version number until hitting 1.0; minor version bumps currently will aim at different versions of Ropsten contracts. Older versions of Ropsten contracts will not be maintained, so in case of issues, make sure there hasn’t been a release.")]),t._v(" "),o("p",[t._v("API stability is not guaranteed, but the API is likely ~90% complete.")]),t._v(" "),o("h2",{attrs:{id:"usage"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),o("p",[t._v("You need two things to use "),o("code",[t._v("tbtc.js")]),t._v(":")]),t._v(" "),o("ul",[o("li",[o("p",[t._v("A working Web3 provider pointed at Ropsten with a funded default account.")])]),t._v(" "),o("li",[o("p",[t._v("A connection to a working Electrum server pointed at the Bitcoin testnet.")])])]),t._v(" "),o("p",[t._v("We are running a public testnet Electrum server currently, but its availability is not guaranteed as it’s not set up for production traffic, so keep an eye out for flakiness. The configuration for the tBTC test Electrum server is below.")]),t._v(" "),o("h3",{attrs:{id:"initializing-the-tbtc-configuration"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#initializing-the-tbtc-configuration"}},[t._v("#")]),t._v(" Initializing the TBTC configuration")]),t._v(" "),o("p",[t._v("Once you’ve required tbtc.js, you can get a handle to a configured TBTC setup:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"aW1wb3J0IFRCVEMgZnJvbSAnLi9zcmMvVEJUQy5qcyc7Cgpjb25zdCB0YnRjID0gYXdhaXQgVEJUQy53aXRoQ29uZmlnKHsKICAgIHdlYjM6IHdlYjMsCiAgICBiaXRjb2luTmV0d29yazogJnF1b3Q7dGVzdG5ldCZxdW90OywKICAgIGVsZWN0cnVtOiB7CiAgICAgICAgJnF1b3Q7dGVzdG5ldCZxdW90OzogewogICAgICAgICAgICAmcXVvdDtzZXJ2ZXImcXVvdDs6ICZxdW90O2VsZWN0cnVteC1zZXJ2ZXIudGVzdC50YnRjLm5ldHdvcmsmcXVvdDssCiAgICAgICAgICAgICZxdW90O3BvcnQmcXVvdDs6IDUwMDAyLAogICAgICAgICAgICAmcXVvdDtwcm90b2NvbCZxdW90OzogJnF1b3Q7c3NsJnF1b3Q7CiAgICAgICAgfSwKICAgICAgICAmcXVvdDt0ZXN0bmV0V1MmcXVvdDs6IHsKICAgICAgICAgICAgJnF1b3Q7c2VydmVyJnF1b3Q7OiAmcXVvdDtlbGVjdHJ1bXgtc2VydmVyLnRlc3QudGJ0Yy5uZXR3b3JrJnF1b3Q7LAogICAgICAgICAgICAmcXVvdDtwb3J0JnF1b3Q7OiA1MDAwMywKICAgICAgICAgICAgJnF1b3Q7cHJvdG9jb2wmcXVvdDs6ICZxdW90O3dzJnF1b3Q7CiAgICAgICAgfQogICAgfSwKfSkK"}}),t._v(" "),o("h3",{attrs:{id:"creating-and-funding-a-deposit"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#creating-and-funding-a-deposit"}},[t._v("#")]),t._v(" Creating and Funding a Deposit")]),t._v(" "),o("p",[t._v("With a configured handle to the system, you can fetch the "),o("code",[t._v("DepositFactory")]),t._v(" and have a look at available lot sizes, in satoshis:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Y29uc3QgbG90U2l6ZXMgPSBhd2FpdCB0YnRjLkRlcG9zaXQuYXZhaWxhYmxlU2F0b3NoaUxvdFNpemVzKCkK"}}),t._v(" "),o("p",[t._v("Then you can make a deposit with any of those; let’s start with the smallest:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Y29uc3QgZGVwb3NpdCA9IGF3YWl0IHRidGMuRGVwb3NpdC53aXRoU2F0b3NoaUxvdFNpemUobG90U2l6ZXNbMF0pCg=="}}),t._v(" "),o("p",[t._v("At this point, you have a handle to a deposit that is in the process of initializing. In the background, a signer group is being selected and undergoing distributed key generation, at which point it will publish its public key to the Ethereum chain. Once that key is published, in the current testnet version, you need to poke the deposit to fetch it from the signers and store it internally. Then you can generate a Bitcoin address from that public key, use that to send a transaction to the generated address on the Bitcoin chain. Then you have to wait for that transaction to accumulate sufficient work (on the testnet, that’s 1 confirmation’s worth), and finally submit a proof to the Ethereum chain that your transaction was sufficiently confirmed. Then the deposit becomes active and you can mint TBTC.")]),t._v(" "),o("p",[t._v("That’s a lot, and it’s annoying, so you can do all of the interchain coordination with one call:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZGVwb3NpdC5hdXRvU3VibWl0KCkK"}}),t._v(" "),o("p",[t._v("This will wait for the public key from the signers, submit it to the Ethereum chain, generate the Bitcoin address, watch for the Bitcoin transaction, wait for the right confirmations, and submit the proof. Your code just needs to listen for the Bitcoin address and present it on the console:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZGVwb3NpdC5vbkJpdGNvaW5BZGRyZXNzQXZhaWxhYmxlKGFzeW5jIChhZGRyZXNzKSA9Jmd0OyB7CiAgICBjb25zdCBsb3RTaXplID0gYXdhaXQgZGVwb3NpdC5nZXRMb3RTaXplU2F0b3NoaXMoKQogICAgY29uc29sZS5sb2coCiAgICAgICAgJnF1b3Q7XHRHb3QgZGVwb3NpdCBhZGRyZXNzOiZxdW90OywgYWRkcmVzcywKICAgICAgICAmcXVvdDs7IGZ1bmQgd2l0aDomcXVvdDssIGxvdFNpemUudG9TdHJpbmcoKSwgJnF1b3Q7c2F0b3NoaXMgcGxlYXNlLiZxdW90OywKICAgICkKICAgIGNvbnNvbGUubG9nKCZxdW90O05vdyBtb25pdG9yaW5nIGZvciBkZXBvc2l0IHRyYW5zYWN0aW9uLi4uJnF1b3Q7KQp9KQo="}}),t._v(" "),o("p",[t._v("And then you can send Bitcoin to that address when it’s printed.")]),t._v(" "),o("p",[t._v("Once the deposit is active, you can mint TBTC. You can wait for that event and react accordingly:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZGVwb3NpdC5vbkFjdGl2ZShhc3luYyAoZGVwb3NpdCkgPSZndDsgewogICAgY29uc29sZS5sb2coJnF1b3Q7RGVwb3NpdCBpcyBhY3RpdmUsIG1pbnRpbmcuLi4mcXVvdDspCiAgICBjb25zdCB0YnRjQml0cyA9IGF3YWl0IGRlcG9zaXQubWludFRCVEMoKQogICAgY29uc29sZS5sb2coYE1pbnRlZCAke3RidGNCaXRzfSBUQlRDIGJpdHMhYCkKICAgIC8vIG9yIGlmIHlvdSB3YW50IHNvbWUgVERUIGFjdGlvbgogICAgLy8gZGVwb3NpdC5kZXBvc2l0VG9rZW5Db250cmFjdC50cmFuc2Zlcihzb21lTHVja3lDb250cmFjdCkKfSkK"}}),t._v(" "),o("p",[t._v("Minting TBTC gives deposit ownership to the tBTC Vending Machine, though this is largely abstracted away here.")]),t._v(" "),o("h3",{attrs:{id:"redeeming-a-deposit"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#redeeming-a-deposit"}},[t._v("#")]),t._v(" Redeeming a Deposit")]),t._v(" "),o("p",[t._v("Once you have enough TBTC, you can redeem an existing deposit. First, you want to look up the deposit you’re trying to redeem:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Y29uc3QgZGVwb3NpdFRvUmVkZWVtID0gYXdhaXQgdGJ0Yy5EZXBvc2l0LndpdGhBZGRyZXNzKCZxdW90OzB4Jmx0O2V4aXN0aW5nIGRlcG9zaXQgYWRkcmVzcyZndDsmcXVvdDspCg=="}}),t._v(" "),o("p",[t._v("Then, you can call requestRedemption and pass it a testnet P2WPKH address:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Y29uc3QgcmVkZW1wdGlvbiA9IGF3YWl0IGRlcG9zaXQucmVxdWVzdFJlZGVtcHRpb24oJnF1b3Q7dGIuLi4mcXVvdDspCg=="}}),t._v(" "),o("p",[t._v("Like funding, redemption requires a bit of coordination between the Ethereum and Bitcoin chains: the client has to construct an unsigned Bitcoin transaction from the signer wallet to the designated redeemer address, the signers must generate a signature for that transaction, and then the client must broadcast that transaction to the Bitcoin chain. Finally, after sufficient work has been included on the Bitcoin chain, the client must notify the Ethereum chain that the deposit is redeemed by submitting a proof to the deposit.")]),t._v(" "),o("p",[t._v("Once again, that can be automated away by a single call:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"cmVkZW1wdGlvbi5hdXRvU3VibWl0KCkK"}}),t._v(" "),o("p",[t._v("If you want to do something once the redemption is completed, you can use the "),o("code",[t._v("onWithdrawn")]),t._v(" handler, which receives the transaction ID/hash of the Bitcoin transaction that redeemed the deposit:")]),t._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"cmVkZW1wdGlvbi5vbldpdGhkcmF3bigodHJhbnNhY3Rpb25JRCkgPSZndDsgewogICAgY29uc29sZS5sb2coCiAgICAgICAgYFJlZGVlbWVkIGRlcG9zaXQgJHtkZXBvc2l0LmFkZHJlc3N9IHdpdGggQml0Y29pbiB0cmFuc2FjdGlvbiBgICsKICAgICAgICBgJHt0cmFuc2FjdGlvbklEfS5gCiAgICApCn0pCg=="}}),t._v(" "),o("h3",{attrs:{id:"managing-lifecycles-manually"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#managing-lifecycles-manually"}},[t._v("#")]),t._v(" Managing Lifecycles Manually")]),t._v(" "),o("p",[t._v("Deposits and redemptions also provide hooks to manage the lifecycle manually for those who are more adventurous and don’t want to opt in to auto-submission. All functionality used by the funding and redemption processes is exposed publicly. For more details, you are encouraged to look at "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc.js/blob/master/src/Deposit.js",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("src/Deposit.js")]),o("OutboundLink")],1),t._v(" and "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc.js/blob/master/src/Redemption.js",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("src/Redemption.js")]),o("OutboundLink")],1),t._v(" (until more details are filled in here…​).")]),t._v(" "),o("h3",{attrs:{id:"interacting-with-ethereum-contracts-directly"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#interacting-with-ethereum-contracts-directly"}},[t._v("#")]),t._v(" Interacting with Ethereum Contracts Directly")]),t._v(" "),o("p",[t._v("Handles to the Ethereum "),o("code",[t._v("TruffleContract")]),t._v(" instances are directly available on the "),o("code",[t._v("tbtc.Deposit")]),t._v(" object. Here is how these map to Solidity files in the tBTC repository:")]),t._v(" "),o("ul",[o("li",[o("p",[o("code",[t._v("tbtc.Deposit.system()")]),t._v(": "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/system/TBTCSystem.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("TBTCSystem.sol")]),o("OutboundLink")],1)])]),t._v(" "),o("li",[o("p",[o("code",[t._v("tbtc.Deposit.depositFactory()")]),t._v(": "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/proxy/DepositFactory.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("DepositFactory.sol")]),o("OutboundLink")],1)])]),t._v(" "),o("li",[o("p",[o("code",[t._v("tbtc.Deposit.token()")]),t._v(": "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/system/TBTCToken.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("TBTCToken.sol")]),o("OutboundLink")],1)])]),t._v(" "),o("li",[o("p",[o("code",[t._v("tbtc.Deposit.depositToken()")]),t._v(": "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/system/TBTCDepositToken.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("TBTCDepositToken.sol")]),o("OutboundLink")],1)])]),t._v(" "),o("li",[o("p",[o("code",[t._v("tbtc.Deposit.vendingMachine()")]),t._v(": "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/system/VendingMachine.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("VendingMachine.sol")]),o("OutboundLink")],1)])]),t._v(" "),o("li",[o("p",[o("code",[t._v("tbtc.Deposit.feeRebateToken()")]),t._v(": "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/system/FeeRebateToken.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("FeeRebateToken.sol")]),o("OutboundLink")],1)])])]),t._v(" "),o("p",[t._v("Finally, the per-deposit contract is available directly on the returned deposit; in the example code above, this would be "),o("code",[t._v("deposit.contract")]),t._v(". This corresponds to the "),o("a",{attrs:{href:"https://github.com/keep-network/tbtc/blob/master/solidity/contracts/deposit/Deposit.sol",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("Deposit.sol")]),o("OutboundLink")],1),t._v(" file in the tBTC system.")])],1)}),[],!1,null,null,null);e.default=a.exports}}]);