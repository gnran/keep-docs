(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{595:function(e,t,r){"use strict";r.r(t);var o=r(0),n=Object(o.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"redemption"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#redemption"}},[e._v("#")]),e._v(" Redemption")]),e._v(" "),r("h2",{attrs:{id:"overview"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),r("p",[e._v('Deposits represent real Bitcoin unspent transaction outputs ("UTXOs") and are redeemable for the BTC held there. The tBTC redemption system aims to provide access to those BTC via a publicly verifiable process.')]),e._v(" "),r("p",[e._v("So long as a deposit is maintained in good standing, the holder of the "),r("RouterLink",{attrs:{to:"/tBTC/minting.html"}},[e._v("non-fungible tBTC Deposit Token")]),e._v(" may "),r("RouterLink",{attrs:{to:"/tBTC/redemption.html#redemption-requests"}},[e._v("request redemption")]),e._v(", relinquishing their NFT and paying any outstanding signer fees associated with the deposit.")],1),e._v(" "),r("p",[e._v("At this point, the redemption process may not be cancelled.")]),e._v(" "),r("p",[e._v("Once redemption has been requested, the signers must produce a valid Bitcoin signature sending the underlying BTC to the requested address. After a signature has been published, any actor may build and submit a redemption transaction to the Bitcoin blockchain using that signature.")]),e._v(" "),r("h3",{attrs:{id:"deposit-terms-and-redemption"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#deposit-terms-and-redemption"}},[e._v("#")]),e._v(" Deposit Terms and Redemption")]),e._v(" "),r("p",[e._v("As noted in the section on "),r("RouterLink",{attrs:{to:"/tBTC/deposits.html#terms"}},[e._v("deposit terms")]),e._v(", a deposit has a fixed term. After that term expires, the deposit becomes unlocked from the deposit owner, so that it can be redeemed by any account (including, notably, the deposit owner account). At this point, redemption costs exactly the lot size of the deposit, with no signer fee due. If the deposit has had the signer fee "),r("RouterLink",{attrs:{to:"/tBTC/minting.html#the-tbtc-vending-machine"}},[e._v("escrowed during TBTC minting")]),e._v(", the signer fee is paid from escrow and the deposit owner is sent the full lot size in TBTC. If the deposit has no escrowed fee, the owner is sent the TBTC used to redeem, less the signer fee, which is distributed to the signers.")],1),e._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",[e._v("For the deposit owner, at term, redemption is free if there are escrowed fees, or costs the signer fee if there are not. This is subtly different from pre-term redemption, where the deposit owner must pay the signer fee "),r("em",[e._v("even if there are escrowed fees")]),e._v(". The additional difference is sent to the Fee Rebate Token holder, who is rebated the signer fee during pre-term redemptions, but not during at-term redemptions.")])]),e._v(" "),r("h2",{attrs:{id:"redemption-requests"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#redemption-requests"}},[e._v("#")]),e._v(" Redemption Requests")]),e._v(" "),r("p",[e._v("A redemption request can be submitted in a few cases:")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("If the deposit is in good standing (has not already been redeemed, has not been accused of "),r("RouterLink",{attrs:{to:"/tBTC/handling-failure.html#fraud"}},[e._v("fraud")]),e._v(", and has not entered "),r("RouterLink",{attrs:{to:"/tBTC/bonding.html#liquidation"}},[e._v("signer liquidation")]),e._v("), pre-term, and the requester holds the corresponding tBTC Deposit Token.")],1)]),e._v(" "),r("li",[r("p",[e._v("If the deposit is in good standing and is at or past "),r("RouterLink",{attrs:{to:"/tBTC/redemption.html#deposit-terms-and-redemption"}},[e._v("term")]),e._v(", irrespective of whether the requester holds the corresponding tBTC Deopsit Token.")],1)]),e._v(" "),r("li",[r("p",[e._v("If the deposit has entered "),r("RouterLink",{attrs:{to:"/tBTC/bonding.html#pre-liquidation-a-courtesy-call"}},[e._v("courtesy call")]),e._v(", an undercollateralization state designed to allow closing deposits before they become dangerously undercollateralized, irrespective of whether the requester holds the corresponding tBTC Deposit Token.")],1)])]),e._v(" "),r("p",[e._v("To "),r("em",[e._v("request redemption")]),e._v(", a requester makes a redemption request transaction to the smart contract on the host chain. The redemption request includes the following:")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("A Bitcoin transaction fee amount (must be >=2000 satoshi (~20 satoshi/vbyte)).")])]),e._v(" "),r("li",[r("p",[e._v("A standard output script for BTC delivery (one of p2pkh, p2sh, p2wpkh, or p2wsh), prefixed by the length of the script. For security and privacy, this SHOULD be controlled by a new keypair.")])]),e._v(" "),r("li",[r("p",[e._v("The deposit’s "),r("RouterLink",{attrs:{to:"/tBTC/redemption.html#repayment-amount"}},[e._v("Repayment Amount")]),e._v(" in TBTC.")],1)])]),e._v(" "),r("p",[e._v("Upon receipt of the "),r("em",[e._v("redemption request")]),e._v(", the smart contract escrows the repayment amount (which includes the signer fee, if due), records the receipt of the request, and notifies the signers that a signature is required.")]),e._v(" "),r("p",[e._v("Once notified of the redemption request, the signers must wait for confirmation on the host chain. If they do not wait for confirmation, the redemption request may be dropped from the chain via a reorg, in which case any signature they produced could be used to both redeem the BTC and submit a signer fraud proof. A fraud proof created this way would appear valid to the host chain smart contract because it no longer has a record of the redemption request.")]),e._v(" "),r("h2",{attrs:{id:"repayment-amount"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#repayment-amount"}},[e._v("#")]),e._v(" Repayment Amount")]),e._v(" "),r("p",[e._v("Conceptually, the repayment amount is the deposit lot size plus the signer fee of 0.005 TBTC per 1 TBTC (50 basis points). This ensures that the signers are paid upon completing redemption, that the owner can be compensated for the redeemed deposit (in redemptions by parties other than the owner), and that the Fee Rebate Token holder can receive their fee rebase (in pre-term redemptions).")]),e._v(" "),r("p",[e._v("After all the math shakes out, the repayment amount can vary depending on the redeeming party, the TDT holder, the FRT holder, and the deposit’s term state. The "),r("a",{attrs:{href:"https://docs.keep.network/tbtc/#deposit-payment-flow",target:"_blank",rel:"noopener noreferrer"}},[e._v("Deposit payment flow"),r("OutboundLink")],1),e._v(" table lists the various combinations that are possible, and the corresponding repayment amounts owed by the redeemer, assuming three possible parties, A, B, and C. It also lists out the relevant disbursal upon redemption proof.")]),e._v(" "),r("h2",{attrs:{id:"redemption-transaction-format"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#redemption-transaction-format"}},[e._v("#")]),e._v(" Redemption Transaction Format")]),e._v(" "),r("p",[e._v("A redemption transaction has a perfectly canonical format which is embedded in the smart contracts running on the tBTC host chain. This prevents a number of complex attacks on the tBTC system, as well as simplifying contract logic. The requester may specify only 2 aspects of the transaction: its fee and its destination. All other deposit-specific information (e.g. the outpoint and the UTXO value) is known to the deposit contract in advance.")]),e._v(" "),r("p",[e._v("The "),r("em",[e._v("redemption transaction")]),e._v(" has 1 input (the deposit UTXO) and 1 output (the redemption output). It does not have change outputs, or additional inputs, as none are needed. It simply transfers the underlying BTC to the sole custody of the requester. Its timelock and sequence numbers are set to 0 and its version is set to 1. Full documentation of the format and the construction of its sighash can be found "),r("a",{attrs:{href:"https://docs.keep.network/tbtc/#sighash",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("Because the format is simple and canonical, any observer may use publicly available information to build it. Once a signature has been published, it is simple to add a witness to the transaction and broadcast it. So while signers have a strong incentive to broadcast the transaction as early as possible, anyone may do so if the signers do not.")]),e._v(" "),r("h2",{attrs:{id:"redemption-proof"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#redemption-proof"}},[e._v("#")]),e._v(" Redemption proof")]),e._v(" "),r("p",[e._v("A "),r("em",[e._v("redemption")]),e._v(" proof is an "),r("a",{attrs:{href:"https://docs.keep.network/tbtc/#spv",target:"_blank",rel:"noopener noreferrer"}},[e._v("SPV proof"),r("OutboundLink")],1),e._v(" that a "),r("em",[e._v("redemption transaction")]),e._v(" was confirmed by the Bitcoin blockchain. Once a request to redeem is confirmed, the deposit smart contract expects a "),r("em",[e._v("redemption proof")]),e._v(" within 6 hours. To validate a "),r("em",[e._v("redemption proof")]),e._v(", the smart contract performs normal SPV proof verification, and additionally verifies that the recipient matches the requester’s specified output script, and the value is greater than or equal "),r("code",[e._v("UTXO Value - highest allowed fee")]),e._v(" (see "),r("RouterLink",{attrs:{to:"/tBTC/redemption.html#allowing-for-bitcoin-fee-adjustment"}},[e._v("Allowing for Bitcoin fee adjustment")]),e._v(" for more details).")],1),e._v(" "),r("p",[e._v("Once redemption proof is confirmed, the signing fee is disbursed, the FRT holder receives their escrowed funds (if the deposit was redeemed pre-term), and the TDT holder receives the remainder of the repayment amount. As with the repayment amount, the amount each of the parties receives in case of a successful redemption varies depending on the TDT holder, FRT holder, redeemer, and deposit state. The "),r("a",{attrs:{href:"https://docs.keep.network/tbtc/#deposit-payment-flow",target:"_blank",rel:"noopener noreferrer"}},[e._v("Deposit payment flow"),r("OutboundLink")],1),e._v(" table lists the various combinations that are possible, and the corresponding repayment amounts owed by the redeemer, assuming three possible parties, A, B, and C.")]),e._v(" "),r("h2",{attrs:{id:"validating-a-signature"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#validating-a-signature"}},[e._v("#")]),e._v(" Validating a signature")]),e._v(" "),r("p",[e._v("After the redemption request is sufficiently confirmed on the host chain, the signers MUST "),r("RouterLink",{attrs:{to:"/tBTC/signing.html"}},[e._v("produce a signature")]),e._v(" on the redemption transaction signature hash as requested. They have 3 hours in which to produce either a signature, or a "),r("RouterLink",{attrs:{to:"/tBTC/redemption.html#redemption-proof"}},[e._v("redemption proof")]),e._v(" before being subject to penalties. Upon submission of a valid signature a redemption proof is still required, but the deadline is extended to 6 hours in total.")],1),e._v(" "),r("p",[e._v("As discussed "),r("RouterLink",{attrs:{to:"/tBTC/redemption.html#redemption-transaction-format"}},[e._v("earlier")]),e._v(", the host chain smart contract managing the deposit has all information necessary to calculate the "),r("em",[e._v("redemption transaction")]),e._v(" signature hash. This includes the signers' threshold public key. Using the public key, the signature hash, and the redemption request the smart contract can know both the cryptographic validity of the signature and that a signature on that digest was requested as part of a redemption process.")],1),e._v(" "),r("h2",{attrs:{id:"allowing-for-bitcoin-fee-adjustment"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#allowing-for-bitcoin-fee-adjustment"}},[e._v("#")]),e._v(" Allowing for Bitcoin fee adjustment")]),e._v(" "),r("p",[e._v("Because Bitcoin fees are determined by network congestion and other highly unpredictable factors, the requester may not select an appropriate fee. Signers are punished if no redemption proof is submitted or if they sign without explicit authorization. This could create a no-win scenario for signers, in which they could not get the requester’s transaction confirmed in the current fee climate and would eventually be punished despite honest behavior. Unfortunately, we cannot rely on the requester to stay online or update fee rates honestly. Ergo, the system requires some mechanism to fairly adjust fee rates without the requester’s explicit consent.")]),e._v(" "),r("p",[e._v("The simplest scheme is to allow signers to increase the fee without requester consent after a timeout. As such, we allow signers to increase fees linearly every 4 hours. Which is to say, if the fee is "),r("code",[e._v("f")]),e._v(", after 4 hours the signers may notify the deposit contract of a fee increase to "),r("code",[e._v("2f")]),e._v(" and if the transaction remains unconfirmed after 8 hours, the signers may notify the contract of a fee increase to "),r("code",[e._v("3f")]),e._v(". This ensures that a redemption transaction will eventually be confirmed on the Bitcoin blockchain near the minimal fee rate given current network congestion. To prevent the signers from repeatedly requesting fee increases, they must actually provide a signature at each fee level. This ensures that each feerate is actually attempted before an increase is requested.")])])}),[],!1,null,null,null);t.default=n.exports}}]);